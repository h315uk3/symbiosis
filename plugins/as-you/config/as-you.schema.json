{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://github.com/h315uk3/symbiosis/plugins/as-you/config/as-you.schema.json",
  "title": "As-You Configuration Schema",
  "description": "Configuration schema for as-you plugin v2",
  "type": "object",
  "required": ["version", "scoring", "memory", "confidence", "diversity", "promotion", "categories", "habits"],
  "properties": {
    "version": {
      "type": "integer",
      "const": 1,
      "description": "Configuration schema version"
    },
    "scoring": {
      "type": "object",
      "required": ["bm25", "pmi", "weights"],
      "properties": {
        "bm25": {
          "type": "object",
          "required": ["enabled", "k1", "b"],
          "properties": {
            "enabled": {
              "type": "boolean",
              "description": "Enable BM25 scoring"
            },
            "k1": {
              "type": "number",
              "minimum": 1.2,
              "maximum": 2.0,
              "description": "BM25 saturation parameter"
            },
            "b": {
              "type": "number",
              "minimum": 0.0,
              "maximum": 1.0,
              "description": "BM25 length normalization parameter"
            }
          }
        },
        "pmi": {
          "type": "object",
          "required": ["enabled", "min_cooccurrence", "window_size"],
          "properties": {
            "enabled": {
              "type": "boolean",
              "description": "Enable PMI scoring"
            },
            "min_cooccurrence": {
              "type": "integer",
              "minimum": 1,
              "maximum": 10,
              "description": "Minimum cooccurrence count"
            },
            "window_size": {
              "type": "integer",
              "minimum": 2,
              "maximum": 10,
              "description": "Cooccurrence window size"
            }
          }
        },
        "weights": {
          "type": "object",
          "required": ["bm25", "pmi", "ebbinghaus"],
          "properties": {
            "bm25": {
              "type": "number",
              "minimum": 0.0,
              "maximum": 1.0,
              "description": "Weight for BM25 score"
            },
            "pmi": {
              "type": "number",
              "minimum": 0.0,
              "maximum": 1.0,
              "description": "Weight for PMI score"
            },
            "ebbinghaus": {
              "type": "number",
              "minimum": 0.0,
              "maximum": 1.0,
              "description": "Weight for Ebbinghaus memory strength"
            }
          }
        }
      }
    },
    "memory": {
      "type": "object",
      "required": ["ebbinghaus", "sm2"],
      "properties": {
        "ebbinghaus": {
          "type": "object",
          "required": ["enabled", "base_strength", "growth_factor"],
          "properties": {
            "enabled": {
              "type": "boolean",
              "description": "Enable Ebbinghaus forgetting curve model"
            },
            "base_strength": {
              "type": "number",
              "minimum": 0.1,
              "maximum": 10.0,
              "description": "Base memory strength in days"
            },
            "growth_factor": {
              "type": "number",
              "minimum": 0.1,
              "maximum": 2.0,
              "description": "Strength increase per repetition"
            }
          }
        },
        "sm2": {
          "type": "object",
          "required": ["enabled", "initial_easiness", "min_easiness"],
          "properties": {
            "enabled": {
              "type": "boolean",
              "description": "Enable SM-2 memory model"
            },
            "initial_easiness": {
              "type": "number",
              "minimum": 1.3,
              "maximum": 3.0,
              "description": "Initial easiness factor"
            },
            "min_easiness": {
              "type": "number",
              "minimum": 1.1,
              "maximum": 2.0,
              "description": "Minimum easiness factor"
            }
          }
        }
      }
    },
    "confidence": {
      "type": "object",
      "required": ["bayesian", "thompson_sampling"],
      "properties": {
        "bayesian": {
          "type": "object",
          "required": ["enabled", "prior_mean", "prior_variance"],
          "properties": {
            "enabled": {
              "type": "boolean",
              "description": "Enable Bayesian learning"
            },
            "prior_mean": {
              "type": "number",
              "minimum": 0.0,
              "maximum": 1.0,
              "description": "Prior distribution mean"
            },
            "prior_variance": {
              "type": "number",
              "minimum": 0.01,
              "maximum": 0.25,
              "description": "Prior distribution variance"
            }
          }
        },
        "thompson_sampling": {
          "type": "object",
          "required": ["enabled", "initial_alpha", "initial_beta"],
          "properties": {
            "enabled": {
              "type": "boolean",
              "description": "Enable Thompson Sampling"
            },
            "initial_alpha": {
              "type": "number",
              "minimum": 0.5,
              "maximum": 5.0,
              "description": "Initial alpha for Beta distribution"
            },
            "initial_beta": {
              "type": "number",
              "minimum": 0.5,
              "maximum": 5.0,
              "description": "Initial beta for Beta distribution"
            }
          }
        }
      }
    },
    "diversity": {
      "type": "object",
      "required": ["shannon_entropy"],
      "properties": {
        "shannon_entropy": {
          "type": "object",
          "required": ["enabled", "context_keys", "aggregation", "max_contexts"],
          "properties": {
            "enabled": {
              "type": "boolean",
              "description": "Enable Shannon entropy diversity tracking"
            },
            "context_keys": {
              "type": "array",
              "items": {
                "type": "string"
              },
              "minItems": 1,
              "description": "Context dimensions to track (e.g., sessions, files)"
            },
            "aggregation": {
              "type": "string",
              "enum": ["mean", "max", "min", "sum"],
              "description": "Method to aggregate entropy across contexts"
            },
            "max_contexts": {
              "type": "integer",
              "minimum": 1,
              "maximum": 100,
              "description": "Maximum number of contexts to track"
            }
          }
        }
      }
    },
    "promotion": {
      "type": "object",
      "required": ["threshold", "min_observations", "min_confidence"],
      "properties": {
        "threshold": {
          "type": "number",
          "minimum": 0.0,
          "maximum": 1.0,
          "description": "Composite score threshold for promotion"
        },
        "min_observations": {
          "type": "integer",
          "minimum": 1,
          "maximum": 10,
          "description": "Minimum observations required for promotion"
        },
        "min_confidence": {
          "type": "number",
          "minimum": 0.0,
          "maximum": 1.0,
          "description": "Minimum confidence required for promotion"
        }
      }
    },
    "categories": {
      "type": "array",
      "items": {
        "type": "string",
        "enum": ["preference", "style", "process", "decision", "observation", "workflow"]
      },
      "minItems": 1,
      "uniqueItems": true,
      "description": "Learning pattern categories"
    },
    "habits": {
      "type": "object",
      "required": ["deduplication_threshold", "clustering_threshold", "min_confidence", "min_freshness", "freshness_half_life_days"],
      "properties": {
        "deduplication_threshold": {
          "type": "number",
          "minimum": 0.0,
          "maximum": 1.0,
          "description": "Similarity threshold for duplicate detection"
        },
        "clustering_threshold": {
          "type": "number",
          "minimum": 0.0,
          "maximum": 1.0,
          "description": "Threshold for grouping similar notes"
        },
        "min_confidence": {
          "type": "number",
          "minimum": 0.0,
          "maximum": 1.0,
          "description": "Minimum confidence for habit extraction"
        },
        "min_freshness": {
          "type": "number",
          "minimum": 0.0,
          "maximum": 1.0,
          "description": "Minimum freshness score for inclusion"
        },
        "freshness_half_life_days": {
          "type": "integer",
          "minimum": 1,
          "maximum": 365,
          "description": "Days for freshness to decay to 0.5"
        }
      }
    }
  }
}
